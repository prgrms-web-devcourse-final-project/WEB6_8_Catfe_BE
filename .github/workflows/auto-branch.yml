name: Auto Branch from Issue

on:
  issues:
    types: [ opened ]

jobs:
  create-branch:
    runs-on: ubuntu-latest
    permissions:
      contents: write

  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Git
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

    - name: Create branch from issue
        run |
          issue_number=${{ github.event.issue.number }}
          issue_title=${{ github.event.issue.title }}
          
          safe_title=$(echo "$issue_title" | tr '[:upper:]' '[:lower:]' | tr ' ' '-' | tr -cd '[:alnum:]-')

          branch_name="issue/${issue_number}-${safe_title}"

          echo "ðŸ“Œ Creating branch: $branch_name from origin/main"
          
          git fetch origin main
          git checkout -b "$branch_name" origin/main
          git push origin "$branch_name"
